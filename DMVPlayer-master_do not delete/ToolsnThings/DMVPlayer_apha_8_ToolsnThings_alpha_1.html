<!DOCTYPE html>
<html>
<head>
    <style>
      body {
        margin: 0px;
        padding: 0px;
      }
    </style>
  </head>
 <body onmousedown="return false;">
 
    <!-- 1. The <iframe> (and video player) will replace this <div> tag. -->
<!--<div id="player"></div> -->
<video id="my_video_1" width="100%" preload="auto" poster>
  <source src="https://dl.dropboxusercontent.com/u/21775654/spin%20falling.mp4" id="movie" type="video/mp4">
 </video>
 <script>
document.getElementById("my_video_1").style.maxWidth="980px";
	  var player = document.getElementById('my_video_1');
    </script>
	<style>

	table,th,td
	{
	font-family: "calibri";
	border-collapse:collapse;
	vertical-align:center;
	position: relative;
	}
	td{
	background-color:rgb(200,200,200);
	}
	th{
	background-color:rgb(230,230,230);
	}
	</style>
	
<table id="button_table_1" width ="100%" border="0">

	<tr>
		<th><input type="button" value="    |<<    " name="beginning" onclick="goToTime(0)" /></th>
		<th><input type="button" value="    |<     " name="skipToPrev" onclick="prevFrame()" /></th>
		<th><input type="button" value="    >/||     " name="playPause" onclick='playPause()' /></th>
		<!--<th><button type="button" id="playPause" onclick=playPause()>></button></th>-->
		<!--<th><input type="button" value="    ||    " name="pauseVid" onclick='pause()' /></th> -->
		<th><input type="button" value="    >|     " name="skipToNext" onclick="fwdFrame()" /></th>
		<!-- <th><input type="button" value="    >>|    " name="end" onclick="myPlayer.currentTime = my_video_1.duration" /></th> -->
		<th><input type="text" id="FrameJump" size="1"/>
		<input type="button" value="Go!" name="goToFrameButton" onclick="goToEnteredFrame()"/></th>
		<!--<th><input type="button" value="dont click me" name="skipToNext" onclick='alert("why did you click me?")' </th> -->
		<!--<th><input type="button" value="hi!" name="hallo" onclick="seek(5)" </th>-->
	</tr>
		
</table>
<script>
document.getElementById("button_table_1").style.maxWidth="980px";
var framerate = 30;
	function goToEnteredFrame(){
		console.log("Going To Frame:");
		var thisFrame = document.getElementById("FrameJump").value;
		console.log(thisFrame);
		seek((1/framerate)*(thisFrame)+(1/framerate));
		pause();
		console.log("go to frame:"+thisFrame);
	}
	
	

	function prevFrame(){
		pause();
		player.currentTime=player.currentTime-(1/framerate);
		//play();
		console.log("prev frame");
		//player.playVideo();
		//pause();
		//setTimeout(pause(), 1);
	}
	
	function playPause(){ 
		if (player.paused) 
 		 play();
		 //document.getElementByName("playPause").innerHTML="||";
		else 
  		 pause();
		// document.getElementByName("playPause").innerHTML=">";
	} 
	
	function pause(){
		player.pause();
		console.log("pause");
	}
	function play(){
		player.play();
		console.log("play");
	}
	function seek(time){
		pause();
		player.currentTime=time;
		console.log("seek");
	}
	function goToTime(time){
		player.currentTime=time;
		console.log("goToTime:" + time);
	}
	function fwdFrame(){
		play();
		//pause();
		//player.currentTime=player.currentTime+(1/framerate);
		setTimeout(function() {player.pause()}, (990/framerate));
		console.log("fwd frame, time: "+player.currentTime);
	}
	window.addEventListener('keydown',this.check,false);
	function check(e) {
		var code = e.keyCode;
		//Left arrow pressed
		if (code == 37)
			prevFrame();
		//Right arrow pressed
		if (code == 39)
			fwdFrame();
		//Down arrow pressed
		if (code == 40)
			prevFrame();
		//Up arrow pressed
		if (code == 38)
			fwdFrame();
		//Spacebar pressed
		if (code == 32)
			playPause();
	}
	</script>
	<div id="container"></div>
    <script src="http://d3lp1msu2r81bx.cloudfront.net/kjs/js/lib/kinetic-v5.0.1.min.js"></script>
	<script>

      function update(activeAnchor) {
        var group = activeAnchor.getParent();

        var topLeft = group.find('.topLeft')[0];
        var topRight = group.find('.topRight')[0];
        var bottomRight = group.find('.bottomRight')[0];
        var bottomLeft = group.find('.bottomLeft')[0];
        var image = group.find('.image')[0];

        var anchorX = activeAnchor.x();
        var anchorY = activeAnchor.y();

        // update anchor positions
        switch (activeAnchor.name()) {
          case 'topLeft':
            topRight.y(anchorY);
            bottomLeft.x(anchorX);
            break;
          case 'topRight':
            topLeft.y(anchorY);
            bottomRight.x(anchorX);
            break;
          case 'bottomRight':
            bottomLeft.y(anchorY);
            topRight.x(anchorX); 
            break;
          case 'bottomLeft':
            bottomRight.y(anchorY);
            topLeft.x(anchorX); 
            break;
        }

        image.setPosition(topLeft.getPosition());

        var width = topRight.x() - topLeft.x();
        var height = bottomLeft.y() - topLeft.y();
        if(width && height) {
          image.setSize({width:width, height: height});
        }
      }
      function addAnchor(group, x, y, name) {
        var stage = group.getStage();
        var layer = group.getLayer();

        var anchor = new Kinetic.Circle({
          x: x,
          y: y,
          stroke: '#666',
          fill: '#ddd',
          strokeWidth: 2,
          radius: 8,
          name: name,
          draggable: true,
          dragOnTop: false
        });

        anchor.on('dragmove', function() {
          update(this);
          layer.draw();
        });
        anchor.on('mousedown touchstart', function() {
          group.setDraggable(false);
          this.moveToTop();
        });
        anchor.on('dragend', function() {
          group.setDraggable(true);
          layer.draw();
        });
        // add hover styling
        anchor.on('mouseover', function() {
          var layer = this.getLayer();
          document.body.style.cursor = 'pointer';
          this.setStrokeWidth(4);
          layer.draw();
        });
        anchor.on('mouseout', function() {
          var layer = this.getLayer();
          document.body.style.cursor = 'default';
          this.strokeWidth(2);
          layer.draw();
        });

        group.add(anchor);
      }
      function loadImages(sources, callback) {
        var images = {};
        var loadedImages = 0;
        var numImages = 0;
        for(var src in sources) {
          numImages++;
        }
        for(var src in sources) {
          images[src] = new Image();
          images[src].onload = function() {
            if(++loadedImages >= numImages) {
              callback(images);
            }
          };
          images[src].src = sources[src];
        }
      }
      function initStage(images) {
        var stage = new Kinetic.Stage({
          container: 'container',
          width: 500,
          height: 500
        });
        var darthVaderGroup = new Kinetic.Group({
          x: 270,
          y: 100,
          draggable: true
        });
        var yodaGroup = new Kinetic.Group({
          x: 100,
          y: 110,
          draggable: true
        });
        var layer = new Kinetic.Layer();

        /*
         * go ahead and add the groups
         * to the layer and the layer to the
         * stage so that the groups have knowledge
         * of its layer and stage
         */
        layer.add(darthVaderGroup);
        layer.add(yodaGroup);
        stage.add(layer);

        // darth vader
        var darthVaderImg = new Kinetic.Image({
          x: 0,
          y: 0,
          image: images.darthVader,
          width: 200,
          height: 138,
          name: 'image'
        });

        darthVaderGroup.add(darthVaderImg);
        addAnchor(darthVaderGroup, 0, 0, 'topLeft');
        addAnchor(darthVaderGroup, 200, 0, 'topRight');
        addAnchor(darthVaderGroup, 200, 138, 'bottomRight');
        addAnchor(darthVaderGroup, 0, 138, 'bottomLeft');

        darthVaderGroup.on('dragstart', function() {
          this.moveToTop();
        });
        // yoda
        var yodaImg = new Kinetic.Image({
          x: 0,
          y: 0,
          image: images.yoda,
          width: 93,
          height: 104,
          name: 'image'
        });

        yodaGroup.add(yodaImg);
        addAnchor(yodaGroup, 0, 0, 'topLeft');
        addAnchor(yodaGroup, 93, 0, 'topRight');
        addAnchor(yodaGroup, 93, 104, 'bottomRight');
        addAnchor(yodaGroup, 0, 104, 'bottomLeft');

        yodaGroup.on('dragstart', function() {
          this.moveToTop();
        });

        stage.draw();
      }

      var sources = {
        darthVader: 'http://etc.usf.edu/clipart/46300/46306/46306_protractor_md.gif',
        yoda: 'https://dl.dropboxusercontent.com/u/21775654/ruler.png'
      };
      loadImages(sources, initStage);

    </script>
  
</body>
	
	
	

</html>
